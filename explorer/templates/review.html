<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fano Explorer - {{ page_title }}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'no-mathjax'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>

    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --border: #475569;
            --border-light: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-dim: #64748b;
            --accent: #38bdf8;
            --accent-hover: #7dd3fc;
            --blessed: #fbbf24;
            --blessed-bg: rgba(251, 191, 36, 0.1);
            --interesting: #60a5fa;
            --interesting-bg: rgba(96, 165, 250, 0.1);
            --rejected: #f87171;
            --rejected-bg: rgba(248, 113, 113, 0.1);
            --success: #4ade80;
            --success-bg: rgba(74, 222, 128, 0.1);
            --warning: #fbbf24;
            --warning-bg: rgba(251, 191, 36, 0.1);
            --disputed: #fb923c;
            --disputed-bg: rgba(251, 146, 60, 0.1);
            --code-bg: #0f172a;
            --gradient-start: #0ea5e9;
            --gradient-end: #8b5cf6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            font-size: 15px;
            line-height: 1.6;
        }

        /* Navigation */
        .nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            padding: 0 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
            height: 64px;
        }

        .nav-brand {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
            letter-spacing: 0.1em;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-links {
            display: flex;
            gap: 0.25rem;
            height: 100%;
        }

        .nav-link {
            padding: 0 1rem;
            height: 100%;
            display: flex;
            align-items: center;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            position: relative;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .nav-link.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .nav-link.blessed { color: var(--blessed); }
        .nav-link.blessed.active { border-bottom-color: var(--blessed); }
        .nav-link.interesting { color: var(--interesting); }
        .nav-link.interesting.active { border-bottom-color: var(--interesting); }
        .nav-link.rejected { color: var(--rejected); }
        .nav-link.rejected.active { border-bottom-color: var(--rejected); }
        .nav-link.disputed { color: var(--disputed); }
        .nav-link.disputed.active { border-bottom-color: var(--disputed); }

        .nav-link .count {
            background: var(--bg-tertiary);
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: 0.5rem;
            font-weight: 600;
        }

        .nav-stats {
            margin-left: auto;
            display: flex;
            gap: 1.5rem;
            font-size: 0.8rem;
        }

        .nav-stat {
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .nav-stat strong {
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Main Content */
        .main {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .page-subtitle {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* Insight Card */
        .insight-card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }

        .insight-card:hover {
            border-color: var(--border);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px);
        }

        .insight-card.disputed {
            border-left: 4px solid var(--disputed);
        }

        .insight-card.modified {
            border-left: 4px solid var(--success);
        }

        .insight-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            background: linear-gradient(180deg, var(--bg-tertiary) 0%, var(--bg-card) 100%);
        }

        .insight-rating {
            font-size: 2rem;
            line-height: 1;
            filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.3));
        }

        .insight-meta {
            flex: 1;
        }

        .insight-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
        }

        .insight-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: var(--bg-tertiary);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            border: 1px solid var(--border-light);
        }

        .tag.confidence-high { background: var(--success-bg); color: var(--success); border-color: var(--success); }
        .tag.confidence-medium { background: var(--warning-bg); color: var(--warning); border-color: var(--warning); }
        .tag.confidence-low { background: var(--rejected-bg); color: var(--rejected); border-color: var(--rejected); }
        .tag.disputed { background: var(--disputed-bg); color: var(--disputed); border-color: var(--disputed); }
        .tag.modified { background: var(--success-bg); color: var(--success); border-color: var(--success); }
        .tag.intractable { background: var(--rejected-bg); color: var(--rejected); border-color: var(--rejected); }
        .tag.round { background: var(--interesting-bg); color: var(--interesting); border-color: var(--interesting); }

        /* Insight Content */
        .insight-content {
            padding: 1.5rem;
            font-size: 1.05rem;
            line-height: 1.8;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
        }

        .insight-content blockquote {
            border-left: 3px solid var(--accent);
            padding-left: 1.25rem;
            margin: 0;
            color: var(--text-primary);
        }

        /* Modified insight display */
        .modified-insight {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--success-bg);
            border: 1px solid var(--success);
            border-radius: 8px;
        }

        .modified-insight-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modified-insight blockquote {
            border-left-color: var(--success);
            color: var(--text-primary);
        }

        /* Collapsible Sections */
        .section {
            border-top: 1px solid var(--border-light);
        }

        .section-header {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            background: var(--bg-card);
            transition: background 0.2s;
            user-select: none;
        }

        .section-header:hover { background: var(--bg-hover); }

        .section-icon {
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }

        .section-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .section-badge {
            margin-left: auto;
            background: var(--bg-tertiary);
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .section-toggle {
            color: var(--text-dim);
            transition: transform 0.2s;
            font-size: 0.8rem;
        }

        .section.collapsed .section-toggle { transform: rotate(-90deg); }
        .section.collapsed .section-content { display: none; }

        /* Collapsible Insight Cards */
        .insight-card .insight-header {
            cursor: pointer;
        }

        .insight-card .insight-header:hover {
            background: linear-gradient(180deg, var(--bg-hover) 0%, var(--bg-card) 100%);
        }

        .insight-preview {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .insight-toggle {
            color: var(--text-dim);
            transition: transform 0.2s;
            font-size: 1rem;
            margin-left: auto;
            padding: 0.5rem;
        }

        .insight-card.collapsed .insight-toggle {
            transform: rotate(-90deg);
        }

        .insight-card.collapsed .insight-body {
            display: none;
        }

        .insight-card.collapsed .insight-preview {
            display: -webkit-box;
        }

        .insight-card:not(.collapsed) .insight-preview {
            display: none;
        }

        /* Expand All / Collapse All Controls */
        .list-controls {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .list-controls .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
        }

        .list-controls .btn-sm:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            transform: none;
            box-shadow: none;
        }

        /* Priority Controls */
        .priority-control {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-left: 0.5rem;
        }

        .priority-btn {
            width: 24px;
            height: 24px;
            border: 1px solid var(--border-light);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            padding: 0;
        }

        .priority-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
            color: var(--accent);
        }

        .priority-btn:active {
            transform: scale(0.95);
        }

        .priority-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .priority-value {
            min-width: 28px;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
        }

        .priority-value.high {
            color: var(--blessed);
            border-color: var(--blessed);
            background: var(--blessed-bg);
        }

        .priority-value.medium {
            color: var(--text-secondary);
        }

        .priority-value.low {
            color: var(--text-dim);
        }

        .priority-label {
            font-size: 0.65rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-right: 0.25rem;
        }

        .section-content {
            padding: 1.25rem 1.5rem;
            background: var(--bg-primary);
            border-top: 1px solid var(--border-light);
        }

        /* Dependencies */
        .dependencies-list p {
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .dependency-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .dependency-link {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s;
        }

        .dependency-link:hover {
            border-color: var(--accent);
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .dependency-link .dep-icon {
            font-size: 0.9rem;
        }

        .dependency-link .dep-id {
            color: var(--text-secondary);
        }

        .dependency-link:hover .dep-id {
            color: var(--accent);
        }

        .dependency-link.resolved {
            border-color: var(--success);
            background: var(--success-bg);
        }

        .dependency-link.resolved .dep-icon {
            color: var(--success);
        }

        .dependency-link.resolved:hover {
            background: rgba(74, 222, 128, 0.2);
        }

        .dependency-link.pending {
            border-color: var(--warning);
            background: var(--warning-bg);
        }

        .dependency-link.pending .dep-icon {
            color: var(--warning);
        }

        .dependency-link.pending:hover {
            background: rgba(251, 191, 36, 0.2);
        }

        /* Review Panel Display */
        .review-round {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-light);
        }

        .review-round:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

        .round-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .round-number {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .round-number.round-4 {
            background: linear-gradient(135deg, var(--disputed), var(--rejected));
        }

        .round-title {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .round-mode {
            font-size: 0.7rem;
            color: var(--text-dim);
            background: var(--bg-tertiary);
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .round-outcome {
            margin-left: auto;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
        }

        .round-outcome.unanimous { background: var(--success-bg); color: var(--success); }
        .round-outcome.split { background: var(--warning-bg); color: var(--warning); }
        .round-outcome.resolved { background: var(--success-bg); color: var(--success); }
        .round-outcome.majority { background: var(--interesting-bg); color: var(--interesting); }
        .round-outcome.intractable { background: var(--rejected-bg); color: var(--rejected); }
        .round-outcome.abandoned { background: var(--rejected-bg); color: var(--rejected); }

        .reviewer-responses {
            display: grid;
            gap: 0.75rem;
        }

        .reviewer-response {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            transition: border-color 0.2s;
        }

        .reviewer-response:hover {
            border-color: var(--border);
        }

        .reviewer-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .reviewer-name {
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: capitalize;
            color: var(--text-primary);
        }

        .reviewer-rating {
            font-size: 1.25rem;
            filter: drop-shadow(0 0 4px rgba(251, 191, 36, 0.2));
        }

        .reviewer-mode {
            font-size: 0.65rem;
            color: var(--text-dim);
            background: var(--bg-tertiary);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .reviewer-changed {
            margin-left: auto;
            font-size: 0.75rem;
            color: var(--warning);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .reviewer-content {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .reviewer-content strong { color: var(--text-primary); }

        .reviewer-content p { margin: 0.5rem 0; }
        .reviewer-content p:first-child { margin-top: 0; }
        .reviewer-content p:last-child { margin-bottom: 0; }

        /* Modification proposal in review */
        .modification-proposal {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: var(--success-bg);
            border: 1px solid var(--success);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .modification-proposal-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--success);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .modification-proposal-text {
            color: var(--text-primary);
        }

        /* Refinement Display */
        .refinement-history {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .refinement-step {
            display: flex;
            gap: 1rem;
            align-items: stretch;
        }

        .refinement-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 40px;
        }

        .refinement-version {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .refinement-line {
            width: 2px;
            flex: 1;
            background: linear-gradient(180deg, var(--gradient-start), var(--gradient-end));
            margin: 0.5rem 0;
            min-height: 30px;
        }

        .refinement-content {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            padding: 1rem 1.25rem;
        }

        .refinement-proposer {
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .refinement-text {
            font-size: 0.9rem;
            line-height: 1.7;
        }

        .refinement-text .old {
            text-decoration: line-through;
            color: var(--text-dim);
            opacity: 0.7;
        }

        .refinement-text .new {
            color: var(--success);
            margin-top: 0.5rem;
            display: block;
        }

        .refinement-changes {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-light);
        }

        .refinement-changes ul {
            margin: 0.25rem 0 0 1rem;
            padding: 0;
        }

        .refinement-changes li { margin: 0.25rem 0; }

        /* Actions */
        .insight-actions {
            padding: 1.25rem 1.5rem;
            display: flex;
            gap: 0.75rem;
            align-items: center;
            background: var(--bg-card);
        }

        .btn {
            padding: 0.65rem 1.25rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-bless {
            background: linear-gradient(135deg, var(--blessed), #f59e0b);
            color: #000;
        }

        .btn-interesting {
            background: linear-gradient(135deg, var(--interesting), #3b82f6);
            color: #fff;
        }

        .btn-reject {
            background: transparent;
            border: 2px solid var(--rejected);
            color: var(--rejected);
        }

        .btn-reject:hover {
            background: var(--rejected);
            color: #fff;
        }

        .btn-round4 {
            background: linear-gradient(135deg, var(--disputed), var(--rejected));
            color: #fff;
        }

        .notes-input {
            flex: 1;
            padding: 0.65rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--text-primary);
            transition: border-color 0.2s;
        }

        .notes-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .notes-input::placeholder {
            color: var(--text-dim);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 6rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            filter: grayscale(0.5);
        }

        .empty-state h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--text-dim);
            max-width: 400px;
            margin: 0 auto;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Mind Changes */
        .mind-changes {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--warning-bg);
            border: 1px solid var(--warning);
            border-radius: 8px;
        }

        .mind-changes-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mind-changes ul {
            margin: 0;
            padding: 0 0 0 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .mind-changes li { margin: 0.25rem 0; }

        /* Markdown */
        .markdown-body h1, .markdown-body h2, .markdown-body h3 {
            margin: 1rem 0 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .markdown-body p { margin: 0.5rem 0; }
        .markdown-body ul, .markdown-body ol { margin: 0.5rem 0; padding-left: 1.5rem; }
        .markdown-body code {
            background: var(--bg-tertiary);
            padding: 0.15em 0.4em;
            border-radius: 4px;
            font-size: 0.875em;
            font-family: 'JetBrains Mono', monospace;
        }
        .markdown-body pre {
            background: var(--code-bg);
            color: var(--text-primary);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid var(--border-light);
        }
        .markdown-body pre code { background: none; padding: 0; color: inherit; }
        .markdown-body table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
        .markdown-body th, .markdown-body td { border: 1px solid var(--border-light); padding: 0.5rem; }
        .markdown-body th { background: var(--bg-tertiary); font-weight: 600; }

        /* Diagram/Table/Proof containers */
        .augmentation { margin-bottom: 1.5rem; }
        .augmentation:last-child { margin-bottom: 0; }

        .augmentation-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .augmentation-type { font-size: 1.25rem; }
        .augmentation-title { font-weight: 600; font-size: 0.95rem; }

        .augmentation-verified {
            margin-left: auto;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 500;
        }

        .augmentation-verified.success { color: var(--success); }
        .augmentation-verified.failed { color: var(--rejected); }

        .augmentation-content {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 10px;
            overflow: hidden;
        }

        .diagram-container {
            padding: 1.5rem;
            text-align: center;
            background: var(--bg-primary);
        }

        .diagram-container img { max-width: 100%; height: auto; border-radius: 8px; }

        .diagram-caption {
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            font-size: 0.85rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-light);
        }

        .code-container pre {
            margin: 0;
            border-radius: 0;
            border: none;
        }

        .code-output {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-top: 1px solid var(--border-light);
        }

        .code-output-label {
            font-size: 0.7rem;
            color: var(--text-dim);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .code-output pre {
            background: var(--bg-primary);
            border: 1px solid var(--border-light);
            padding: 0.75rem;
            font-size: 0.85rem;
            border-radius: 6px;
            margin: 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-dim);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <a href="/" class="nav-brand">FANO EXPLORER</a>
        <div class="nav-links">
            <a href="/reviewing" class="nav-link {% if current_status == 'reviewing' %}active{% endif %}">
                üîÑ In Review
                <span class="count" id="stat-reviewing">{{ stats.reviewing or 0 }}</span>
            </a>
            <a href="/" class="nav-link {% if current_status == 'pending' %}active{% endif %}">
                Pending
                <span class="count" id="stat-pending">{{ stats.pending or 0 }}</span>
            </a>
            <a href="/disputed" class="nav-link disputed {% if current_status == 'disputed' %}active{% endif %}">
                ‚ö†Ô∏è Disputed
                <span class="count" id="stat-disputed">{{ stats.disputed or 0 }}</span>
            </a>
            <a href="/blessed" class="nav-link blessed {% if current_status == 'blessed' %}active{% endif %}">
                ‚ö° Blessed
                <span class="count" id="stat-blessed">{{ stats.blessed or 0 }}</span>
            </a>
            <a href="/interesting" class="nav-link interesting {% if current_status == 'interesting' %}active{% endif %}">
                ? Interesting
                <span class="count" id="stat-interesting">{{ stats.interesting or 0 }}</span>
            </a>
            <a href="/rejected" class="nav-link rejected {% if current_status == 'rejected' %}active{% endif %}">
                ‚úó Rejected
                <span class="count" id="stat-rejected">{{ stats.rejected or 0 }}</span>
            </a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="page-header">
            <div>
                <h1 class="page-title">{{ page_title }}</h1>
                {% if current_status == 'disputed' %}
                <p class="page-subtitle">Insights that remain disputed after 3 rounds. Run Round 4 to attempt modification.</p>
                {% elif current_status == 'reviewing' %}
                <p class="page-subtitle">Insights currently being processed by the review panel.</p>
                {% endif %}
            </div>
        </div>

        {% if insights %}
            {% if not viewing_single %}
            <!-- List Controls -->
            <div class="list-controls">
                <button class="btn btn-sm" onclick="expandAll()">Expand All</button>
                <button class="btn btn-sm" onclick="collapseAll()">Collapse All</button>
                <span style="color: var(--text-dim); font-size: 0.8rem; margin-left: auto;">
                    {{ insights|length }} insight{% if insights|length != 1 %}s{% endif %}
                </span>
            </div>
            {% endif %}

            {% for item in insights %}
            {% set insight = item.insight %}
            {% set review = item.review %}
            {% set augmentations = item.augmentations %}

            <article class="insight-card {% if not viewing_single %}collapsed{% endif %} {% if insight.is_disputed %}disputed{% endif %} {% if review and review.final_insight_text %}modified{% endif %}" id="insight-{{ insight.id }}">
                <!-- Header (clickable to expand/collapse) -->
                <div class="insight-header" onclick="toggleInsightCard(this)">
                    <span class="insight-rating">{{ insight.rating or '‚óã' }}</span>
                    <div class="insight-meta">
                        <div class="insight-id">
                            {{ insight.id }} ¬∑ {{ insight.extracted_at.strftime('%Y-%m-%d %H:%M') }}
                            ¬∑ {{ insight.extraction_model }}
                        </div>
                        <div class="insight-tags">
                            <span class="tag confidence-{{ insight.confidence }}">{{ insight.confidence }}</span>
                            {% if review and review.rounds %}
                            <span class="tag round">{{ review.rounds|length }} round{% if review.rounds|length != 1 %}s{% endif %}</span>
                            {% endif %}
                            {% if item.rounds_completed is defined and current_status == 'reviewing' %}
                            <span class="tag round">Round {{ item.rounds_completed }}/3</span>
                            {% endif %}
                            {% if insight.is_disputed %}
                            <span class="tag disputed">DISPUTED</span>
                            {% endif %}
                            {% if review and review.final_insight_text and review.final_insight_text != insight.insight %}
                            <span class="tag modified">MODIFIED</span>
                            {% endif %}
                            {% for tag in insight.tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        <!-- Preview shown when collapsed -->
                        <div class="insight-preview">{{ insight.insight[:200] }}{% if insight.insight|length > 200 %}...{% endif %}</div>
                    </div>
                    <!-- Priority Control (only for pending/interesting/disputed) -->
                    {% if current_status in ['pending', 'interesting', 'disputed'] %}
                    <div class="priority-control" onclick="event.stopPropagation()">
                        <span class="priority-label">Pri</span>
                        <button class="priority-btn" onclick="changePriority('{{ insight.id }}', -1)" {% if insight.priority <= 1 %}disabled{% endif %}>‚àí</button>
                        <span class="priority-value {% if insight.priority >= 8 %}high{% elif insight.priority >= 4 %}medium{% else %}low{% endif %}" id="priority-{{ insight.id }}">{{ insight.priority }}</span>
                        <button class="priority-btn" onclick="changePriority('{{ insight.id }}', 1)" {% if insight.priority >= 10 %}disabled{% endif %}>+</button>
                    </div>
                    {% endif %}
                    <span class="insight-toggle">‚ñº</span>
                </div>

                <!-- Insight Body (hidden when collapsed) -->
                <div class="insight-body">
                <!-- Insight Content -->
                <div class="insight-content">
                    <blockquote>{{ insight.insight }}</blockquote>

                    {% if review and review.final_insight_text and review.final_insight_text != insight.insight %}
                    <div class="modified-insight">
                        <div class="modified-insight-label">
                            ‚ú® Modified Version (accepted)
                        </div>
                        <blockquote>{{ review.final_insight_text }}</blockquote>
                    </div>
                    {% endif %}
                </div>

                <!-- Dependencies -->
                {% if insight.depends_on or insight.pending_dependencies %}
                <div class="section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span class="section-icon">üîó</span>
                        <span class="section-title">Dependencies</span>
                        <span class="section-badge">{{ insight.depends_on|length + insight.pending_dependencies|length }}</span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        {% if insight.depends_on %}
                        <div class="dependencies-list">
                            <p><strong>Resolved:</strong></p>
                            <div class="dependency-links">
                                {% for dep in insight.depends_on %}
                                <a href="/insight/{{ dep }}" class="dependency-link resolved" title="View {{ dep }}">
                                    <span class="dep-icon">‚úì</span>
                                    <span class="dep-id">{{ dep }}</span>
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        {% if insight.pending_dependencies %}
                        <div class="dependencies-list" {% if insight.depends_on %}style="margin-top: 1rem;"{% endif %}>
                            <p><strong>Pending:</strong></p>
                            <div class="dependency-links">
                                {% for dep in insight.pending_dependencies %}
                                <a href="/insight/{{ dep }}" class="dependency-link pending" title="View {{ dep }}">
                                    <span class="dep-icon">‚óã</span>
                                    <span class="dep-id">{{ dep }}</span>
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Review Panel -->
                {% if review %}
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span class="section-icon">üéØ</span>
                        <span class="section-title">Review Panel</span>
                        <span class="section-badge">
                            {% if review.is_unanimous %}Unanimous{% else %}{{ review.rounds|length }} rounds{% endif %}
                        </span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        {% for round in review.rounds %}
                        <div class="review-round">
                            <div class="round-header">
                                <span class="round-number {% if round.round_number == 4 %}round-4{% endif %}">{{ round.round_number }}</span>
                                <span class="round-title">
                                    {% if round.round_number == 1 %}
                                    Independent Review
                                    {% elif round.round_number == 2 %}
                                    Deep Analysis
                                    {% elif round.round_number == 3 %}
                                    Deliberation
                                    {% elif round.round_number == 4 %}
                                    Modification Focus
                                    {% else %}
                                    Round {{ round.round_number }}
                                    {% endif %}
                                </span>
                                <span class="round-mode">{{ round.mode }}</span>
                                <span class="round-outcome {{ round.outcome }}">
                                    {{ round.outcome }}
                                </span>
                            </div>
                            <div class="reviewer-responses">
                                {% for llm, resp in round.responses.items() %}
                                <div class="reviewer-response">
                                    <div class="reviewer-header">
                                        <span class="reviewer-name">{{ llm }}</span>
                                        <span class="reviewer-rating">{{ resp.rating }}</span>
                                        <span class="reviewer-mode">{{ resp.mode }}</span>
                                        {% if resp.changed_mind %}
                                        <span class="reviewer-changed">‚Üª Changed</span>
                                        {% endif %}
                                    </div>
                                    <div class="reviewer-content">
                                        {% if round.round_number == 4 %}
                                        {# Round 4: Modification focus fields #}
                                        {% if resp.reasoning %}
                                        <p><strong>Assessment:</strong> {{ resp.reasoning }}</p>
                                        {% endif %}
                                        {% elif round.round_number == 3 %}
                                        {# Round 3: Deliberation-specific fields #}
                                        {% if resp.strongest_argument %}
                                        <p><strong>Strongest Argument:</strong> {{ resp.strongest_argument }}</p>
                                        {% endif %}
                                        {% if resp.response_to_argument %}
                                        <p><strong>Response:</strong> {{ resp.response_to_argument }}</p>
                                        {% endif %}
                                        {% if resp.final_stance %}
                                        <p><strong>Final Stance:</strong> <span class="tag">{{ resp.final_stance }}</span></p>
                                        {% endif %}
                                        {% if resp.reasoning %}
                                        <p><strong>Reasoning:</strong> {{ resp.reasoning }}</p>
                                        {% endif %}
                                        {% else %}
                                        {# Round 1 & 2: Standard fields #}
                                        <p><strong>Reasoning:</strong> {{ resp.reasoning }}</p>
                                        {% if resp.naturalness_assessment %}
                                        <p><strong>Naturalness:</strong> {{ resp.naturalness_assessment }}</p>
                                        {% endif %}
                                        {% if resp.structural_analysis %}
                                        <p><strong>Structure:</strong> {{ resp.structural_analysis }}</p>
                                        {% endif %}
                                        {% if resp.mathematical_verification %}
                                        <p><strong>Math:</strong> {{ resp.mathematical_verification }}</p>
                                        {% endif %}
                                        {% endif %}
                                        {% if resp.new_information %}
                                        <p><strong>New Information:</strong> {{ resp.new_information }}</p>
                                        {% endif %}

                                        {# Show modification proposal if present #}
                                        {% if resp.proposed_modification %}
                                        <div class="modification-proposal">
                                            <div class="modification-proposal-label">üìù Proposed Modification</div>
                                            <div class="modification-proposal-text">{{ resp.proposed_modification }}</div>
                                            {% if resp.modification_rationale %}
                                            <p style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-dim);"><em>{{ resp.modification_rationale }}</em></p>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}

                        {% if review.mind_changes %}
                        <div class="mind-changes">
                            <div class="mind-changes-title">
                                üîÑ Mind Changes
                            </div>
                            <ul>
                                {% for mc in review.mind_changes %}
                                <li><strong>{{ mc.llm }}</strong> changed from {{ mc.from_rating }} to {{ mc.to_rating }}: {{ mc.reason }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Refinement History -->
                {% if review and review.refinements %}
                <div class="section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span class="section-icon">‚úèÔ∏è</span>
                        <span class="section-title">Modification History</span>
                        <span class="section-badge">{{ review.refinements|length }} modifications</span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        <div class="refinement-history">
                            {% for ref in review.refinements %}
                            <div class="refinement-step">
                                <div class="refinement-arrow">
                                    <span class="refinement-version">v{{ ref.from_version }}</span>
                                    <div class="refinement-line"></div>
                                    <span class="refinement-version">v{{ ref.to_version }}</span>
                                </div>
                                <div class="refinement-content">
                                    {% if ref.proposer %}
                                    <div class="refinement-proposer">
                                        Proposed by {{ ref.proposer }}
                                        {% if ref.round_proposed %} in Round {{ ref.round_proposed }}{% endif %}
                                    </div>
                                    {% endif %}
                                    <div class="refinement-text">
                                        <span class="old">{{ ref.original_insight }}</span>
                                        <span class="new">‚Üí {{ ref.refined_insight }}</span>
                                    </div>
                                    {% if ref.changes_made %}
                                    <div class="refinement-changes">
                                        <strong>Changes:</strong>
                                        <ul>
                                            {% for change in ref.changes_made %}
                                            <li>{{ change }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Augmentations -->
                {% if augmentations and augmentations.augmentations %}
                <div class="section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <span class="section-icon">üìé</span>
                        <span class="section-title">Augmentations</span>
                        <span class="section-badge">{{ augmentations.augmentations|length }}</span>
                        <span class="section-toggle">‚ñº</span>
                    </div>
                    <div class="section-content">
                        {% for aug in augmentations.augmentations %}
                        <div class="augmentation">
                            <div class="augmentation-header">
                                {% if aug.type.value == 'diagram' %}
                                <span class="augmentation-type">üìä</span>
                                <span class="augmentation-title">Diagram</span>
                                {% elif aug.type.value == 'table' %}
                                <span class="augmentation-type">üìã</span>
                                <span class="augmentation-title">Table</span>
                                {% elif aug.type.value == 'proof' %}
                                <span class="augmentation-type">üìù</span>
                                <span class="augmentation-title">Formal Proof</span>
                                {% elif aug.type.value == 'code' %}
                                <span class="augmentation-type">üíª</span>
                                <span class="augmentation-title">Verification Code</span>
                                {% endif %}

                                {% if aug.verified %}
                                <span class="augmentation-verified success">‚úì Verified</span>
                                {% elif aug.execution_success == false %}
                                <span class="augmentation-verified failed">‚úó Failed</span>
                                {% endif %}
                            </div>

                            <div class="augmentation-content">
                                {% if aug.type.value == 'diagram' %}
                                {% if aug.file_path %}
                                <div class="diagram-container">
                                    <img src="/api/augmentation/{{ insight.id }}/diagram"
                                         alt="{{ aug.caption }}"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                    <p style="display:none; color: var(--text-dim); padding: 2rem;">
                                        Diagram image not found
                                    </p>
                                </div>
                                {% else %}
                                <div class="diagram-container">
                                    <p style="color: var(--text-dim); margin-bottom: 1rem;">
                                        üìä Diagram code generated (image not yet rendered)
                                    </p>
                                    <details>
                                        <summary style="cursor: pointer; color: var(--accent);">View code</summary>
                                        <pre style="text-align: left; margin: 1rem 0;">{{ aug.content }}</pre>
                                    </details>
                                </div>
                                {% endif %}
                                {% if aug.caption %}
                                <div class="diagram-caption">{{ aug.caption }}</div>
                                {% endif %}

                                {% elif aug.type.value == 'table' %}
                                <div class="markdown-body" style="padding: 1rem;">
                                    {{ aug.content | markdown | safe }}
                                </div>

                                {% elif aug.type.value == 'proof' %}
                                <div class="markdown-body" style="padding: 1rem;">
                                    {{ aug.content | markdown | safe }}
                                </div>
                                {% if aug.verification_notes %}
                                <div style="padding: 0.75rem 1rem; background: var(--bg-tertiary); border-top: 1px solid var(--border-light); font-size: 0.85rem; color: var(--text-secondary);">
                                    {{ aug.verification_notes }}
                                </div>
                                {% endif %}

                                {% elif aug.type.value == 'code' %}
                                <div class="code-container">
                                    <pre><code>{{ aug.content }}</code></pre>
                                </div>
                                {% if aug.execution_output %}
                                <div class="code-output">
                                    <div class="code-output-label">Output</div>
                                    <pre>{{ aug.execution_output }}</pre>
                                </div>
                                {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Actions -->
                {% if current_status == 'pending' %}
                <div class="insight-actions">
                    <button class="btn btn-bless" onclick="submitFeedback('{{ insight.id }}', 'bless')">
                        ‚ö° Bless
                    </button>
                    <button class="btn btn-interesting" onclick="submitFeedback('{{ insight.id }}', 'interesting')">
                        ? Interesting
                    </button>
                    <button class="btn btn-reject" onclick="submitFeedback('{{ insight.id }}', 'reject')">
                        ‚úó Reject
                    </button>
                    <input type="text" class="notes-input" id="notes-{{ insight.id }}"
                           placeholder="Optional notes...">
                </div>
                {% elif current_status == 'disputed' %}
                <div class="insight-actions">
                    <p style="color: var(--text-dim); font-size: 0.85rem; flex: 1;">
                        Run <code style="background: var(--bg-tertiary); padding: 0.2rem 0.5rem; border-radius: 4px;">python fano_explorer.py retry-disputed</code> to trigger Round 4 for all disputed insights.
                    </p>
                </div>
                {% endif %}
                </div><!-- End insight-body -->
            </article>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <div class="icon">
                    {% if current_status == 'disputed' %}‚öñÔ∏è{% elif current_status == 'blessed' %}‚ö°{% elif current_status == 'rejected' %}üóëÔ∏è{% else %}‚ú®{% endif %}
                </div>
                <h2>No insights in this category</h2>
                <p>
                    {% if current_status == 'pending' %}
                    The exploration is running. Check back soon for new insights.
                    {% elif current_status == 'disputed' %}
                    No disputed insights! All reviews have reached consensus.
                    {% elif current_status == 'reviewing' %}
                    No insights are currently being reviewed.
                    {% else %}
                    Nothing here yet.
                    {% endif %}
                </p>
            </div>
        {% endif %}
    </main>

    <script>
        function toggleSection(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        function toggleInsightCard(header) {
            header.closest('.insight-card').classList.toggle('collapsed');
        }

        function expandAll() {
            document.querySelectorAll('.insight-card.collapsed').forEach(card => {
                card.classList.remove('collapsed');
            });
        }

        function collapseAll() {
            document.querySelectorAll('.insight-card:not(.collapsed)').forEach(card => {
                card.classList.add('collapsed');
            });
        }

        async function changePriority(insightId, delta) {
            const valueEl = document.getElementById(`priority-${insightId}`);
            const currentPriority = parseInt(valueEl.textContent);
            const newPriority = Math.max(1, Math.min(10, currentPriority + delta));

            if (newPriority === currentPriority) return;

            try {
                const response = await fetch('/api/priority', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        insight_id: insightId,
                        priority: newPriority
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Update display
                    valueEl.textContent = data.priority;

                    // Update color class
                    valueEl.classList.remove('high', 'medium', 'low');
                    if (data.priority >= 8) valueEl.classList.add('high');
                    else if (data.priority >= 4) valueEl.classList.add('medium');
                    else valueEl.classList.add('low');

                    // Update button states
                    const control = valueEl.closest('.priority-control');
                    const buttons = control.querySelectorAll('.priority-btn');
                    buttons[0].disabled = data.priority <= 1;  // decrease button
                    buttons[1].disabled = data.priority >= 10; // increase button

                    // Brief visual feedback
                    valueEl.style.transform = 'scale(1.2)';
                    setTimeout(() => valueEl.style.transform = '', 150);
                } else {
                    console.error('Error updating priority:', data.error);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function submitFeedback(insightId, feedback) {
            const notes = document.getElementById(`notes-${insightId}`).value;

            try {
                const response = await fetch('/api/feedback', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        insight_id: insightId,
                        feedback: feedback,
                        notes: notes
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const card = document.getElementById(`insight-${insightId}`);
                    card.style.opacity = '0';
                    card.style.transform = 'translateX(100%)';
                    card.style.transition = 'all 0.3s';

                    setTimeout(() => {
                        card.remove();
                        updateStats();
                        if (document.querySelectorAll('.insight-card').length === 0) {
                            location.reload();
                        }
                    }, 300);

                    showToast(`Marked as ${feedback}`);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to submit feedback');
            }
        }

        async function updateStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                document.getElementById('stat-reviewing').textContent = stats.reviewing || 0;
                document.getElementById('stat-pending').textContent = stats.pending || 0;
                document.getElementById('stat-disputed').textContent = stats.disputed || 0;
                document.getElementById('stat-blessed').textContent = stats.blessed || 0;
                document.getElementById('stat-interesting').textContent = stats.interesting || 0;
                document.getElementById('stat-rejected').textContent = stats.rejected || 0;
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        // Trigger MathJax rendering
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                MathJax.typesetPromise().catch(err => console.log('MathJax error:', err));
            }
        });

        // Refresh stats periodically
        setInterval(updateStats, 30000);
    </script>
</body>
</html>
